---
keywords: fastai
title: Guide to Dealing with CORS 
badges: true
toc: true
comments: true
nb_path: _notebooks/2023-02-17-cors.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-02-17-cors.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-is-CORS?">What is CORS?<a class="anchor-link" href="#What-is-CORS?"> </a></h2><ul>
<li>Cross-Origin Resource Sharing (CORS) is an HTTP-header based mechanism that allows a server to indicate any origins (domain, scheme, or port) other than its own from which a browser should permit loading resources.</li>
<li>Its essentially a security feature</li>
</ul>
<p>How it goes down:</p>
<ol>
<li>The browser(frontend) sends the GET request with an extra Origin HTTP header to service.example.com (deployed backend) containing the domain that served the parent page <br>
<code>Origin: http://www.example.com</code> // frontend url</li>
<li>The server at service.example.com sends one of these responses:
<br>
<code>Access-Control-Allow-Origin: http://www.example.com</code> //backend allows the frontend url to access its contents <br>
<code>Access-Control-Allow-Origin: *</code> //backend allows any site to access its contents</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Issues-with-CORS">Issues with CORS<a class="anchor-link" href="#Issues-with-CORS"> </a></h2><ul>
<li>When trying to start a local server and test your frontend and backend connection, cors is often something that gets in the way.</li>
<li>Unfortunately this error can prevent any sort of backend connection without proper code. Usually this error will appear when a header for cors is not specified or your backend url is not permitted by cors</li>
</ul>
<p><img src="https://github.com/vivianknee/FastPages/blob/master/images/error.jpg?raw=true" alt="error"></p>
<p>I'm sure you've seen it... 
So here's a method to bypass CORS locally. Eventually, when both your frontend and backend are deployed, it's good practice to have CORS implemented since your site could have some security risk if you simply bypass it. 
In this blog I've provided two methods to get around cors.</p>
<ol>
<li>Local method with google extension</li>
<li>Access-Control-Allow-Origin</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Solutions">Solutions<a class="anchor-link" href="#Solutions"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Bypassing-Cors-Locally-with-an-Extensions">Bypassing Cors Locally with an Extensions<a class="anchor-link" href="#Bypassing-Cors-Locally-with-an-Extensions"> </a></h3><ul>
<li>Its very handy to be able to bypass cors locally because it makes testing and debugging a lot faster.
#### Setup local backend<blockquote><p>How to bypass CORS with a local backend and frontend running</p>
</blockquote>
</li>
</ul>
<ol>
<li>Have your backend and frontend servers running locally. </li>
<li>Get the url of your backend server. In this case:Python Flask
<img src="https://github.com/vivianknee/FastPages/blob/master/images/url.png?raw=true" alt="url"></li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Setup-frontend-fetch">Setup frontend fetch<a class="anchor-link" href="#Setup-frontend-fetch"> </a></h4><ul>
<li>Use the url from the step above to write a 'fetch' statement (doesn't have to be like whats written below) to reference the local url and your api</li>
<li>note: this extension works both for when the frontend is deployed and when it is running locally</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8080/api/yourapi/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">();</span>
  <span class="p">});</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Download-Extension">Download Extension<a class="anchor-link" href="#Download-Extension"> </a></h4><ul>
<li>Good for quick testing purposes</li>
<li>Download this Google chrome extension: <a href="https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf?hl=en">Allow CORS: Access-Control-Allow-origin</a></li>
<li>Toggle the extension so that its ON
<img src="https://github.com/vivianknee/FastPages/blob/master/images/cors.jpg?raw=true" alt="url"></li>
</ul>
<p>Now try interacting with your frontend site, and the fetch will work</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Access-Control-Allow-Origin-response-header">Access-Control-Allow-Origin response header<a class="anchor-link" href="#Access-Control-Allow-Origin-response-header"> </a></h3><ul>
<li>Another method we have done in the past is adding a 'Access-Control-Allow-Origin' header on the requested resource</li>
<li>The Access-Control-Allow-Origin header is included in the response(response comes from backend) from site B to a request(fetch from frontend) site A, and identifies the permitted origin of the request. A web browser compares the Access-Control-Allow-Origin with the requesting website's origin and permits access to the response if they match.
<img src="https://github.com/vivianknee/FastPages/blob/master/images/sites.jpg?raw=true" alt="sites">
A better model:
<img src="https://github.com/vivianknee/FastPages/blob/master/images/system.jpg?raw=true" alt="system"></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a code segment that maintains cors security and only allows the frontend site to fetch from a specific url, which in our case would be the backend deployed server.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;http://example.com/api/data&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
  <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">response</span> <span class="o">=&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
<span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">data</span> <span class="o">=&gt;</span> <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">error</span> <span class="o">=&gt;</span> <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>the '*' means that the backend url can be accessed with any request from any site through cors. If you only wanted the backend site to be accessed by the frontend, you would replace the asterisk with your site url.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Here's another way. We used this method in trimester 1.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">const</span> <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;backendurl.com&quot;</span><span class="p">;</span>

  <span class="o">//</span> <span class="n">prepare</span> <span class="n">fetch</span> <span class="n">GET</span> <span class="n">options</span>
  <span class="n">const</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="o">*</span><span class="n">GET</span><span class="p">,</span> <span class="n">POST</span><span class="p">,</span> <span class="n">PUT</span><span class="p">,</span> <span class="n">DELETE</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
    <span class="n">mode</span><span class="p">:</span> <span class="s1">&#39;cors&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="n">no</span><span class="o">-</span><span class="n">cors</span><span class="p">,</span> <span class="o">*</span><span class="n">cors</span><span class="p">,</span> <span class="n">same</span><span class="o">-</span><span class="n">origin</span>
    <span class="n">cache</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="o">*</span><span class="n">default</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="p">,</span> <span class="n">reload</span><span class="p">,</span> <span class="n">force</span><span class="o">-</span><span class="n">cache</span><span class="p">,</span> <span class="n">only</span><span class="o">-</span><span class="k">if</span><span class="o">-</span><span class="n">cached</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="s1">&#39;omit&#39;</span><span class="p">,</span> <span class="o">//</span> <span class="n">include</span><span class="p">,</span> <span class="o">*</span><span class="n">same</span><span class="o">-</span><span class="n">origin</span><span class="p">,</span> <span class="n">omit</span>
    <span class="n">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
      <span class="o">//</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>
  <span class="o">//</span> <span class="n">prepare</span> <span class="n">fetch</span> <span class="n">PUT</span> <span class="n">options</span><span class="p">,</span> <span class="n">clones</span> <span class="k">with</span> <span class="n">JS</span> <span class="n">Spread</span> <span class="n">Operator</span> <span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="n">const</span> <span class="n">put_options</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="n">options</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;PUT&#39;</span><span class="p">};</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="CORS-but-for-deployed-backend">CORS but for deployed backend<a class="anchor-link" href="#CORS-but-for-deployed-backend"> </a></h2><ul>
<li>The Access Control Allow Origin header is actually automatically implemented when you setup your backend server on AWS. When you set up the nginx configuration files, you'll notice:
<img src="https://github.com/vivianknee/FastPages/blob/master/images/aws.jpg?raw=true" alt="aws">
As you can see the same exact line <strong>'Access-Control-Allow-Origin': '*'</strong> is present in the nginx files in sites-available and sites-enabled</li>
<li>because of this, your frontend server doesn't need any code to bypass cors because its already implemented on the server side. The extension mentioned previously is also no longer needed</li>
</ul>

</div>
</div>
</div>
</div>
 

